---
/**
 * Analytics & Tracking Component
 * Loads all analytics scripts in the correct order with proper configuration
 */
import { analyticsConfig } from '../config/analytics';

const shouldLoadAnalytics = analyticsConfig.enableInProduction || analyticsConfig.enableInDevelopment;
---

{shouldLoadAnalytics && (
  <>
    <!-- Google Tag Manager -->
    {analyticsConfig.gtm.enabled && (
      <>
        <script is:inline define:vars={{ gtmId: analyticsConfig.gtm.containerId }}>
          (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
          new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
          j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
          'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
          })(window,document,'script','dataLayer',gtmId);
        </script>
      </>
    )}

    <!-- Google Analytics 4 (if not using GTM) -->
    {analyticsConfig.ga4.enabled && !analyticsConfig.gtm.enabled && (
      <>
        <script async src={`https://www.googletagmanager.com/gtag/js?id=${analyticsConfig.ga4.measurementId}`}></script>
        <script is:inline define:vars={{ gaId: analyticsConfig.ga4.measurementId }}>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', gaId, {
            send_page_view: true,
            cookie_flags: 'SameSite=None;Secure'
          });
        </script>
      </>
    )}

    <!-- Microsoft Clarity -->
    {analyticsConfig.clarity.enabled && (
      <script is:inline define:vars={{ clarityId: analyticsConfig.clarity.id }}>
        (function(c,l,a,r,i,t,y){
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", clarityId);
      </script>
    )}

    <!-- Hotjar -->
    {analyticsConfig.hotjar.enabled && (
      <script is:inline define:vars={{ hjid: analyticsConfig.hotjar.id }}>
        (function(h,o,t,j,a,r){
          h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
          h._hjSettings={hjid:hjid,hjsv:6};
          a=o.getElementsByTagName('head')[0];
          r=o.createElement('script');r.async=1;
          r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
          a.appendChild(r);
        })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
      </script>
    )}

    <!-- Meta Pixel (Facebook) -->
    {analyticsConfig.meta.enabled && (
      <script is:inline define:vars={{ pixelId: analyticsConfig.meta.pixelId }}>
        !function(f,b,e,v,n,t,s)
        {if(f.fbq)return;n=f.fbq=function(){n.callMethod?
        n.callMethod.apply(n,arguments):n.queue.push(arguments)};
        if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
        n.queue=[];t=b.createElement(e);t.async=!0;
        t.src=v;s=b.getElementsByTagName(e)[0];
        s.parentNode.insertBefore(t,s)}(window, document,'script',
        'https://connect.facebook.net/en_US/fbevents.js');
        fbq('init', pixelId);
        fbq('track', 'PageView');
      </script>
      <noscript>
        <img height="1" width="1" style="display:none"
          src={`https://www.facebook.com/tr?id=${analyticsConfig.meta.pixelId}&ev=PageView&noscript=1`}
        />
      </noscript>
    )}

    <!-- LinkedIn Insight Tag -->
    {analyticsConfig.linkedin.enabled && (
      <>
        <script type="text/javascript" is:inline define:vars={{ partnerId: analyticsConfig.linkedin.partnerId }}>
          _linkedin_partner_id = partnerId;
          window._linkedin_data_partner_ids = window._linkedin_data_partner_ids || [];
          window._linkedin_data_partner_ids.push(_linkedin_partner_id);
        </script>
        <script type="text/javascript">
          (function(l) {
            if (!l){window.lintrk = function(a,b){window.lintrk.q.push([a,b])};
            window.lintrk.q=[]}
            var s = document.getElementsByTagName("script")[0];
            var b = document.createElement("script");
            b.type = "text/javascript";b.async = true;
            b.src = "https://snap.licdn.com/li.lms-analytics/insight.min.js";
            s.parentNode.insertBefore(b, s);
          })(window.lintrk);
        </script>
        <noscript>
          <img height="1" width="1" style="display:none;" alt=""
            src={`https://px.ads.linkedin.com/collect/?pid=${analyticsConfig.linkedin.partnerId}&fmt=gif`}
          />
        </noscript>
      </>
    )}

    <!-- Twitter Pixel -->
    {analyticsConfig.twitter.enabled && (
      <script is:inline define:vars={{ twitterId: analyticsConfig.twitter.pixelId }}>
        !function(e,t,n,s,u,a){e.twq||(s=e.twq=function(){s.exe?s.exe.apply(s,arguments):s.queue.push(arguments);
        },s.version='1.1',s.queue=[],u=t.createElement(n),u.async=!0,u.src='https://static.ads-twitter.com/uwt.js',
        a=t.getElementsByTagName(n)[0],a.parentNode.insertBefore(u,a))}(window,document,'script');
        twq('config', twitterId);
      </script>
    )}

    <!-- Sentry Error Tracking -->
    {analyticsConfig.sentry.enabled && (
      <script>
        import * as Sentry from "@sentry/browser";
        Sentry.init({
          dsn: analyticsConfig.sentry.dsn,
          environment: import.meta.env.NODE_ENV,
          tracesSampleRate: 1.0,
        });
      </script>
    )}
  </>
)}

<!-- Google Tag Manager (noscript) -->
{shouldLoadAnalytics && analyticsConfig.gtm.enabled && (
  <noscript>
    <iframe
      src={`https://www.googletagmanager.com/ns.html?id=${analyticsConfig.gtm.containerId}`}
      height="0"
      width="0"
      style="display:none;visibility:hidden">
    </iframe>
  </noscript>
)}

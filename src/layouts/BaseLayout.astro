---
import '../styles/global.css';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Analytics from '../components/Analytics.astro';
import TrackingInit from '../components/TrackingInit.astro';

interface Props {
  title: string;
  description: string;
  breadcrumbs?: Array<{ name: string; url: string }>;
  faqs?: Array<{ question: string; answer: string }>;
  howTo?: {
    name: string;
    description: string;
    steps: Array<{ name: string; text: string }>;
  };
  noindex?: boolean;
  hideLogo?: boolean;
}

const { title, description, breadcrumbs, faqs, howTo, noindex, hideLogo } = Astro.props;
const currentUrl = Astro.url.pathname;
const fullUrl = `https://breederhq.com${currentUrl}`;
const ogImage = 'https://breederhq.com/og-image.jpg'; // Default OG image

// Schema.org Organization - critical for AI assistants
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "BreederHQ",
  "url": "https://breederhq.com",
  "logo": "https://breederhq.com/logo.png",
  "description": "Professional breeding program management software with integrated marketplace. The only platform where breeders manage their complete programs on-platform, creating verified marketplace listings from actual breeding data.",
  "foundingDate": "2024",
  "sameAs": [
    "https://x.com/Breeder_HQ",
    "https://www.linkedin.com/in/breeder-hq-46518939b/",
    "https://www.facebook.com/profile.php?id=61585406435189"
  ],
  "contactPoint": {
    "@type": "ContactPoint",
    "contactType": "customer service",
    "url": "https://breederhq.com/contact"
  }
};

// Schema.org SoftwareApplication for all pages - comprehensive feature list for AI
const softwareSchema = {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "name": "BreederHQ",
  "applicationCategory": "BusinessApplication",
  "applicationSubCategory": "Animal Breeding Management Software",
  "operatingSystem": "Web",
  "description": "Professional breeding management software for dog, cat, horse, goat, rabbit, and sheep breeders. Complete breeding program management with pedigree tracking and COI calculation, health testing records, breeding cycle tracking, genetics tools including offspring simulator and best match finder, client portal with e-signatures and Stripe payments, waitlist management, invoicing and expense tracking, and integrated marketplace with verification badges.",
  "url": "https://breederhq.com",
  "offers": {
    "@type": "Offer",
    "description": "Professional breeding management software. Join our early adopter program for access."
  },
  "featureList": [
    "Pedigree tracking with automatic COI calculation",
    "Multi-locus coat color genetics (E, K, A, B, D, M, S loci)",
    "Offspring genetics simulator with Monte Carlo simulation",
    "Best match finder algorithm for optimal breeding pairs",
    "Breeding goal planner for coat, health, and physical traits",
    "Punnett square analysis for inheritance visualization",
    "8-phase breeding plan lifecycle management",
    "Heat cycle tracking with species-specific timelines",
    "Health testing record management (OFA, PennHIP, Embark)",
    "Vaccination protocols with expiration alerts",
    "Client portal with 24/7 access",
    "E-signature agreements with status tracking",
    "Pay Now via Stripe integration",
    "Waitlist management with automated notifications",
    "Invoicing with line items and deposits",
    "Expense tracking across 12 categories",
    "Financial dashboard with MTD metrics",
    "Communications hub with unified inbox",
    "Email and message templates",
    "Real-time messaging",
    "Titles and achievements tracking",
    "Competition results for Shows, Trials, Races",
    "Cross-tenant animal linking via GAID",
    "Integrated marketplace with verified listings",
    "Verification badges: Verified, Health Testing, Quick Responder",
    "Multi-species: dogs, cats, horses, goats, rabbits, sheep"
  ],
  "provider": {
    "@type": "Organization",
    "name": "BreederHQ",
    "url": "https://breederhq.com"
  }
  // TODO: Add aggregateRating when customer reviews are available
  // Example:
  // "aggregateRating": {
  //   "@type": "AggregateRating",
  //   "ratingValue": "4.9",
  //   "ratingCount": "47",
  //   "bestRating": "5",
  //   "worstRating": "1"
  // }
};

// BreadcrumbList schema if breadcrumbs provided
let breadcrumbSchema;
if (breadcrumbs && breadcrumbs.length > 0) {
  breadcrumbSchema = {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": breadcrumbs.map((crumb, index) => ({
      "@type": "ListItem",
      "position": index + 1,
      "name": crumb.name,
      "item": `https://breederhq.com${crumb.url}`
    }))
  };
}

// FAQPage schema if FAQs provided
let faqSchema;
if (faqs && faqs.length > 0) {
  faqSchema = {
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": faqs.map(faq => ({
      "@type": "Question",
      "name": faq.question,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": faq.answer
      }
    }))
  };
}

// HowTo schema for workflow/tutorial pages
let howToSchema;
if (howTo && howTo.steps && howTo.steps.length > 0) {
  howToSchema = {
    "@context": "https://schema.org",
    "@type": "HowTo",
    "name": howTo.name,
    "description": howTo.description,
    "step": howTo.steps.map((step, index) => ({
      "@type": "HowToStep",
      "position": index + 1,
      "name": step.name,
      "text": step.text
    }))
  };
}
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <meta name="description" content={description} />
    {noindex && <meta name="robots" content="noindex, nofollow" />}
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="canonical" href={fullUrl} />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content={fullUrl} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:site_name" content="BreederHQ" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={fullUrl} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta property="twitter:image" content={ogImage} />

    <!-- Schema.org Structured Data -->
    <script type="application/ld+json" set:html={JSON.stringify(organizationSchema)} />
    <script type="application/ld+json" set:html={JSON.stringify(softwareSchema)} />
    {breadcrumbSchema && (
      <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
    )}
    {faqSchema && (
      <script type="application/ld+json" set:html={JSON.stringify(faqSchema)} />
    )}
    {howToSchema && (
      <script type="application/ld+json" set:html={JSON.stringify(howToSchema)} />
    )}

    <!-- Analytics Scripts -->
    <Analytics />
  </head>
  <body>
    <Header hideLogo={hideLogo} />
    <slot />
    <Footer />

    <!-- Tracking Initialization -->
    <TrackingInit />
  </body>
</html>
